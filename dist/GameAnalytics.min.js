(function(scope){
var CryptoJS=CryptoJS||function(e,n){var t={},i=t.lib={},r=function(){},s=i.Base={extend:function(e){r.prototype=this;var n=new r;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=s.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=void 0!=n?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var n=this.words,t=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)n[i+r>>>2]|=(t[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<t.length)for(r=0;r<e;r+=4)n[i+r>>>2]=t[r>>>2];else n.push.apply(n,t);return this.sigBytes+=e,this},clamp:function(){var n=this.words,t=this.sigBytes;n[t>>>2]&=4294967295<<32-t%4*8,n.length=e.ceil(t/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(n){for(var t=[],i=0;i<n;i+=4)t.push(4294967296*e.random()|0);return new o.init(t,n)}}),a=t.enc={},u=a.Hex={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],i=0;i<e;i++){var r=n[i>>>2]>>>24-i%4*8&255;t.push((r>>>4).toString(16)),t.push((15&r).toString(16))}return t.join("")},parse:function(e){for(var n=e.length,t=[],i=0;i<n;i+=2)t[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(t,n/2)}},c=a.Latin1={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],i=0;i<e;i++)t.push(String.fromCharCode(n[i>>>2]>>>24-i%4*8&255));return t.join("")},parse:function(e){for(var n=e.length,t=[],i=0;i<n;i++)t[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(t,n)}},d=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(n){var t=this._data,i=t.words,r=t.sigBytes,s=this.blockSize,a=r/(4*s),a=n?e.ceil(a):e.max((0|a)-this._minBufferSize,0);if(n=a*s,r=e.min(4*n,r),n){for(var u=0;u<n;u+=s)this._doProcessBlock(i,u);u=i.splice(0,n),t.sigBytes-=r}return new o.init(u,r)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=l.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(n,t){return new e.init(t).finalize(n)}},_createHmacHelper:function(e){return function(n,t){return new f.HMAC.init(e,t).finalize(n)}}});var f=t.algo={};return t}(Math);!function(e){for(var n=CryptoJS,t=n.lib,i=t.WordArray,r=t.Hasher,t=n.algo,s=[],o=[],a=function(e){return 4294967296*(e-(0|e))|0},u=2,c=0;64>c;){var d;e:{d=u;for(var l=e.sqrt(d),f=2;f<=l;f++)if(!(d%f)){d=!1;break e}d=!0}d&&(8>c&&(s[c]=a(e.pow(u,.5))),o[c]=a(e.pow(u,1/3)),c++),u++}var v=[],t=t.SHA256=r.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(e,n){for(var t=this._hash.words,i=t[0],r=t[1],s=t[2],a=t[3],u=t[4],c=t[5],d=t[6],l=t[7],f=0;64>f;f++){if(16>f)v[f]=0|e[n+f];else{var m=v[f-15],g=v[f-2];v[f]=((m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3)+v[f-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+v[f-16]}m=l+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&d)+o[f]+v[f],g=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&s^r&s),l=d,d=c,c=u,u=a+m|0,a=s,s=r,r=i,i=m+g|0}t[0]=t[0]+i|0,t[1]=t[1]+r|0,t[2]=t[2]+s|0,t[3]=t[3]+a|0,t[4]=t[4]+u|0,t[5]=t[5]+c|0,t[6]=t[6]+d|0,t[7]=t[7]+l|0},_doFinalize:function(){var n=this._data,t=n.words,i=8*this._nDataBytes,r=8*n.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=e.floor(i/4294967296),t[15+(r+64>>>9<<4)]=i,n.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=r._createHelper(t),n.HmacSHA256=r._createHmacHelper(t)}(Math),function(){var e=CryptoJS,n=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var i=e.blockSize,r=4*i;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),o=this._iKey=t.clone(),a=s.words,u=o.words,c=0;c<i;c++)a[c]^=1549556828,u[c]^=909522486;s.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var n=this._hasher;return e=n.finalize(e),n.reset(),n.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=CryptoJS,n=e.lib.WordArray;e.enc.Base64={stringify:function(e){var n=e.words,t=e.sigBytes,i=this._map;e.clamp(),e=[];for(var r=0;r<t;r+=3)for(var s=(n[r>>>2]>>>24-r%4*8&255)<<16|(n[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|n[r+2>>>2]>>>24-(r+2)%4*8&255,o=0;4>o&&r+.75*o<t;o++)e.push(i.charAt(s>>>6*(3-o)&63));if(n=i.charAt(64))for(;e.length%4;)e.push(n);return e.join("")},parse:function(e){var t=e.length,i=this._map,r=i.charAt(64);r&&-1!=(r=e.indexOf(r))&&(t=r);for(var r=[],s=0,o=0;o<t;o++)if(o%4){var a=i.indexOf(e.charAt(o-1))<<o%4*2,u=i.indexOf(e.charAt(o))>>>6-o%4*2;r[s>>>2]|=(a|u)<<24-s%4*8,s++}return n.create(r,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}();var gameanalytics;!function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical"}(e.EGAErrorSeverity||(e.EGAErrorSeverity={}));!function(e){e[e.Undefined=0]="Undefined",e[e.Male=1]="Male",e[e.Female=2]="Female"}(e.EGAGender||(e.EGAGender={}));!function(e){e[e.Undefined=0]="Undefined",e[e.Start=1]="Start",e[e.Complete=2]="Complete",e[e.Fail=3]="Fail"}(e.EGAProgressionStatus||(e.EGAProgressionStatus={}));!function(e){e[e.Undefined=0]="Undefined",e[e.Source=1]="Source",e[e.Sink=2]="Sink"}(e.EGAResourceFlowType||(e.EGAResourceFlowType={}));!function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Rejected=1]="Rejected"}(e.EGASdkErrorType||(e.EGASdkErrorType={}));!function(e){e[e.NoResponse=0]="NoResponse",e[e.BadResponse=1]="BadResponse",e[e.RequestTimeout=2]="RequestTimeout",e[e.JsonEncodeFailed=3]="JsonEncodeFailed",e[e.JsonDecodeFailed=4]="JsonDecodeFailed",e[e.InternalServerError=5]="InternalServerError",e[e.BadRequest=6]="BadRequest",e[e.Unauthorized=7]="Unauthorized",e[e.UnknownResponseCode=8]="UnknownResponseCode",e[e.Ok=9]="Ok"}(e.EGAHTTPApiResponse||(e.EGAHTTPApiResponse={}))}(e.http||(e.http={}))}(gameanalytics||(gameanalytics={}));var EGAErrorSeverity=gameanalytics.EGAErrorSeverity,EGAGender=gameanalytics.EGAGender,EGAProgressionStatus=gameanalytics.EGAProgressionStatus,EGAResourceFlowType=gameanalytics.EGAResourceFlowType,gameanalytics;!function(e){!function(e){var n=function(){function e(){}return e.getHmac=function(e,n){var t=CryptoJS.HmacSHA256(n,e);return CryptoJS.enc.Base64.stringify(t)},e.stringMatch=function(e,n){return!(!e||!n)&&n.test(e)},e.joinStringArray=function(e,n){for(var t="",i=0,r=e.length;i<r;i++)i>0&&(t+=n),t+=e[i];return t},e.stringArrayContainsString=function(e,n){if(0===e.length)return!1;for(var t in e)if(e[t]===n)return!0;return!1},e.encode64=function(n){n=encodeURI(n);var t,i,r,s,o,a="",u=0,c=0,d=0;do{t=n.charCodeAt(d++),i=n.charCodeAt(d++),u=n.charCodeAt(d++),r=t>>2,s=(3&t)<<4|i>>4,o=(15&i)<<2|u>>6,c=63&u,isNaN(i)?o=c=64:isNaN(u)&&(c=64),a=a+e.keyStr.charAt(r)+e.keyStr.charAt(s)+e.keyStr.charAt(o)+e.keyStr.charAt(c),t=i=u=0,r=s=o=c=0}while(d<n.length);return a},e.decode64=function(n){var t,i,r,s,o,a="",u=0,c=0,d=0;/[^A-Za-z0-9\+\/\=]/g.exec(n),n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{r=e.keyStr.indexOf(n.charAt(d++)),s=e.keyStr.indexOf(n.charAt(d++)),o=e.keyStr.indexOf(n.charAt(d++)),c=e.keyStr.indexOf(n.charAt(d++)),t=r<<2|s>>4,i=(15&s)<<4|o>>2,u=(3&o)<<6|c,a+=String.fromCharCode(t),64!=o&&(a+=String.fromCharCode(i)),64!=c&&(a+=String.fromCharCode(u)),t=i=u=0,r=s=o=c=0}while(d<n.length);return decodeURI(a)},e.timeIntervalSince1970=function(){var e=new Date;return Math.round(e.getTime()/1e3)},e.createGuid=function(){return(e.s4()+e.s4()+"-"+e.s4()+"-4"+e.s4().substr(0,3)+"-"+e.s4()+"-"+e.s4()+e.s4()+e.s4()).toLowerCase()},e.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e}();e.GAUtilities=n}(e.utilities||(e.utilities={}))}(gameanalytics||(gameanalytics={}));var gameanalytics;!function(e){!function(n){var t=e.http.EGASdkErrorType,i=e.utilities.GAUtilities,r=function(){function n(){}return n.validateBusinessEvent=function(e,t,i,r,s){return!!n.validateCurrency(e)&&(!(t<0)&&(!!n.validateShortString(i,!0)&&(!!n.validateEventPartLength(r,!1)&&(!!n.validateEventPartCharacters(r)&&(!!n.validateEventPartLength(s,!1)&&!!n.validateEventPartCharacters(s))))))},n.validateResourceEvent=function(t,r,s,o,a,u,c){return t!=e.EGAResourceFlowType.Undefined&&(!!r&&(!!i.stringArrayContainsString(u,r)&&(s>0&&(!!o&&(!!n.validateEventPartLength(o,!1)&&(!!n.validateEventPartCharacters(o)&&(!!i.stringArrayContainsString(c,o)&&(!!n.validateEventPartLength(a,!1)&&!!n.validateEventPartCharacters(a)))))))))},n.validateProgressionEvent=function(t,i,r,s){if(t==e.EGAProgressionStatus.Undefined)return!1;if(s&&!r&&i)return!1;if(r&&!i)return!1;if(!i)return!1;if(!n.validateEventPartLength(i,!1))return!1;if(!n.validateEventPartCharacters(i))return!1;if(r){if(!n.validateEventPartLength(r,!0))return!1;if(!n.validateEventPartCharacters(r))return!1}if(s){if(!n.validateEventPartLength(s,!0))return!1;if(!n.validateEventPartCharacters(s))return!1}return!0},n.validateDesignEvent=function(e,t){return!!n.validateEventIdLength(e)&&!!n.validateEventIdCharacters(e)},n.validateErrorEvent=function(t,i){return t!=e.EGAErrorSeverity.Undefined&&!!n.validateLongString(i,!0)},n.validateSdkErrorEvent=function(e,i,r){return!!n.validateKeys(e,i)&&r!==t.Undefined},n.validateKeys=function(e,n){return!(!i.stringMatch(e,/^[A-z0-9]{32}$/)||!i.stringMatch(n,/^[A-z0-9]{40}$/))},n.validateCurrency=function(e){return!!e&&!!i.stringMatch(e,/^[A-Z]{3}$/)},n.validateEventPartLength=function(e,n){return!(!n||e)||!!e&&!(e.length>64)},n.validateEventPartCharacters=function(e){return!!i.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}$/)},n.validateEventIdLength=function(e){return!!e&&!!i.stringMatch(e,/^[^:]{1,64}(?::[^:]{1,64}){0,4}$/)},n.validateEventIdCharacters=function(e){return!!e&&!!i.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}(:[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}){0,4}$/)},n.validateAndCleanInitRequestResponse=function(e){if(null==e)return null;var n={};try{n.enabled=e.enabled}catch(e){return null}try{var t=e.server_ts;if(!(t>0))return null;n.server_ts=t}catch(e){return null}try{var i=e.configurations;n.configurations=i}catch(e){return null}return n},n.validateBuild=function(e){return!!n.validateShortString(e,!1)},n.validateSdkWrapperVersion=function(e){return!!i.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/)},n.validateEngineVersion=function(e){return!(!e||!i.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/))},n.validateUserId=function(e){return!!n.validateString(e,!1)},n.validateShortString=function(e,n){return!(!n||e)||!(!e||e.length>32)},n.validateString=function(e,n){return!(!n||e)||!(!e||e.length>64)},n.validateLongString=function(e,n){return!(!n||e)||!(!e||e.length>8192)},n.validateConnectionType=function(e){return i.stringMatch(e,/^(wwan|wifi|lan|offline)$/)},n.validateCustomDimensions=function(e){return n.validateArrayOfStrings(20,32,!1,"custom dimensions",e)},n.validateResourceCurrencies=function(e){if(!n.validateArrayOfStrings(20,64,!1,"resource currencies",e))return!1;for(var t=0;t<e.length;++t)if(!i.stringMatch(e[t],/^[A-Za-z]+$/))return!1;return!0},n.validateResourceItemTypes=function(e){if(!n.validateArrayOfStrings(20,32,!1,"resource item types",e))return!1;for(var t=0;t<e.length;++t)if(!n.validateEventPartCharacters(e[t]))return!1;return!0},n.validateDimension01=function(e,n){return!e||!!i.stringArrayContainsString(n,e)},n.validateDimension02=function(e,n){return!e||!!i.stringArrayContainsString(n,e)},n.validateDimension03=function(e,n){return!e||!!i.stringArrayContainsString(n,e)},n.validateArrayOfStrings=function(e,n,t,i,r){var s=i;if(s||(s="Array"),!r)return!1;if(0==t&&0==r.length)return!1;if(e>0&&r.length>e)return!1;for(var o=0;o<r.length;++o){var a=r[o]?r[o].length:0;if(0===a)return!1;if(n>0&&a>n)return!1}return!0},n.validateFacebookId=function(e){return!!n.validateString(e,!1)},n.validateGender=function(n){if(isNaN(Number(e.EGAGender[n]))){if(n==e.EGAGender.Undefined||n!=e.EGAGender.Male&&n!=e.EGAGender.Female)return!1}else if(n==e.EGAGender[e.EGAGender.Undefined]||n!=e.EGAGender[e.EGAGender.Male]&&n!=e.EGAGender[e.EGAGender.Female])return!1;return!0},n.validateBirthyear=function(e){return!(e<0||e>9999)},n.validateClientTs=function(e){return!(e<-4294967294||e>4294967294)},n}();n.GAValidator=r}(e.validators||(e.validators={}))}(gameanalytics||(gameanalytics={}));var Platfrom=require("react-native").Platfrom,NetInfo=require("react-native").NetInfo,DeviceInfo=require("react-native-device-info"),gameanalytics;!function(e){!function(e){var n=function(){function e(e,n,t){this.name=e,this.value=n,this.version=t}return e}();e.NameValueVersion=n;var t=function(){function e(e,n){this.name=e,this.version=n}return e}();e.NameVersion=t;var i=function(){function e(){}return e.touch=function(){},e.getRelevantSdkVersion=function(){return e.sdkGameEngineVersion?e.sdkGameEngineVersion:e.sdkWrapperVersion},e.getConnectionType=function(){return e.connectionType},e.updateConnectionType=function(){e.connectionType="unknown",NetInfo.getConnectionInfo().then(function(n){e.connectionType=n.type})},e.getOSVersionString=function(){return Platfrom.OS+" "+DeviceInfo.getSystemVersion()},e.runtimePlatformToString=function(){return Platfrom.OS},e.getBrowserVersionString=function(){return"unknown"},e.getDeviceModel=function(){return DeviceInfo.getModel()},e.getDeviceManufacturer=function(){return DeviceInfo.getBrand()},e.sdkWrapperVersion="react-native 1.0.0",e.buildPlatform=e.runtimePlatformToString(),e.deviceModel=e.getDeviceModel(),e.deviceManufacturer=e.getDeviceManufacturer(),e.osVersion=e.getOSVersionString(),e.browserVersion=e.getBrowserVersionString(),e.maxSafeInteger=Math.pow(2,53)-1,e}();e.GADevice=i}(e.device||(e.device={}))}(gameanalytics||(gameanalytics={}));var gameanalytics;!function(e){!function(e){var n=function(){function e(n){this.deadline=n,this.ignore=!1,this.async=!1,this.running=!1,this.id=++e.idCounter}return e.idCounter=0,e}();e.TimedBlock=n}(e.threading||(e.threading={}))}(gameanalytics||(gameanalytics={}));var gameanalytics;!function(e){!function(e){var n=function(){function e(e){this.comparer=e,this._subQueues={},this._sortedKeys=[]}return e.prototype.enqueue=function(e,n){-1===this._sortedKeys.indexOf(e)&&this.addQueueOfPriority(e),this._subQueues[e].push(n)},e.prototype.addQueueOfPriority=function(e){var n=this;this._sortedKeys.push(e),this._sortedKeys.sort(function(e,t){return n.comparer.compare(e,t)}),this._subQueues[e]=[]},e.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},e.prototype.hasItems=function(){return this._sortedKeys.length>0},e.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},e.prototype.dequeueFromHighPriorityQueue=function(){var e=this._sortedKeys[0],n=this._subQueues[e].shift();return 0===this._subQueues[e].length&&(this._sortedKeys.shift(),delete this._subQueues[e]),n},e}();e.PriorityQueue=n}(e.threading||(e.threading={}))}(gameanalytics||(gameanalytics={}));var AsyncStorage=require("react-native").AsyncStorage,gameanalytics;!function(e){var n;!function(e){var t;!function(e){e[e.Equal=0]="Equal",e[e.LessOrEqual=1]="LessOrEqual",e[e.NotEqual=2]="NotEqual"}(t=e.EGAStoreArgsOperator||(e.EGAStoreArgsOperator={}));var i;!function(e){e[e.Events=0]="Events",e[e.Sessions=1]="Sessions",e[e.Progression=2]="Progression"}(i=e.EGAStore||(e.EGAStore={}));var r=function(){function e(){var n=this;AsyncStorage.getAllKeys().then(function(t){var i=t.filter(function(e){return e.includes(s.KeyPrefix)});AsyncStorage.multiGet(i).then(function(t){t.forEach(e.saveItem.bind(n))})})}return e.handleError=function(e,n){var t;t=n?e+"() requires at least "+n+" as its first parameter.":e,console.warn(t)},e.prototype.getItem=function(n){return e.data[n]},e.prototype.setItem=function(n,t){return n?(e.data[n]=t,AsyncStorage.setItem(n,JSON.stringify(t))):e.handleError("set","a key")},e.prototype.removeItem=function(n){return n?(delete e.data[n],AsyncStorage.removeItem(n)):e.handleError("remove","a key")},e.saveItem=function(n){var t;try{t=JSON.parse(n[1])}catch(e){t=n[1]}e.data[n[0]]=t,e.loading=!1},e.prototype.getAllKeys=function(){return Array(Object.keys(e.data))},e.data={},e.loading=!0,e}();e.SyncStorage=r;var s=function(){function e(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"==typeof AsyncStorage?(e.SyncStorage.setItem("testingAsyncStorage","yes"),e.SyncStorage.removeItem("testingAsyncStorage"),e.storageAvailable=!0):e.storageAvailable=!1}catch(e){}}return e.isStorageAvailable=function(){return e.storageAvailable},e.isStoreTooLargeForEvents=function(){return e.instance.eventsStore.length+e.instance.sessionsStore.length>e.MaxNumberOfEntries},e.select=function(n,i,r,s){void 0===i&&(i=[]),void 0===r&&(r=!1),void 0===s&&(s=0);var o=e.getStore(n);if(!o)return null;for(var a=[],u=0;u<o.length;++u){for(var c=o[u],d=!0,l=0;l<i.length;++l){var f=i[l];if(c[f[0]])switch(f[1]){case t.Equal:d=c[f[0]]==f[2];break;case t.LessOrEqual:d=c[f[0]]<=f[2];break;case t.NotEqual:d=c[f[0]]!=f[2];break;default:d=!1}else d=!1;if(!d)break}d&&a.push(c)}return r&&a.sort(function(e,n){return e.client_ts-n.client_ts}),s>0&&a.length>s&&(a=a.slice(0,s+1)),a},e.update=function(n,i,r){void 0===r&&(r=[]);var s=e.getStore(n);if(!s)return!1;for(var o=0;o<s.length;++o){for(var a=s[o],u=!0,c=0;c<r.length;++c){var d=r[c];if(a[d[0]])switch(d[1]){case t.Equal:u=a[d[0]]==d[2];break;case t.LessOrEqual:u=a[d[0]]<=d[2];break;case t.NotEqual:u=a[d[0]]!=d[2];break;default:u=!1}else u=!1;if(!u)break}if(u)for(var c=0;c<i.length;++c){var l=i[c];a[l[0]]=l[1]}}return!0},e.delete=function(n,i){var r=e.getStore(n);if(r)for(var s=0;s<r.length;++s){for(var o=r[s],a=!0,u=0;u<i.length;++u){var c=i[u];if(o[c[0]])switch(c[1]){case t.Equal:a=o[c[0]]==c[2];break;case t.LessOrEqual:a=o[c[0]]<=c[2];break;case t.NotEqual:a=o[c[0]]!=c[2];break;default:a=!1}else a=!1;if(!a)break}a&&(r.splice(s,1),--s)}},e.insert=function(n,t,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);var s=e.getStore(n);if(s)if(i){if(!r)return;for(var o=!1,a=0;a<s.length;++a){var u=s[a];if(u[r]==t[r]){for(var c in t)u[c]=t[c];o=!0;break}}o||s.push(t)}else s.push(t)},e.save=function(){e.isStorageAvailable()&&(e.SyncStorage.setItem(e.KeyPrefix+e.EventsStoreKey,JSON.stringify(e.instance.eventsStore)),e.SyncStorage.setItem(e.KeyPrefix+e.SessionsStoreKey,JSON.stringify(e.instance.sessionsStore)),e.SyncStorage.setItem(e.KeyPrefix+e.ProgressionStoreKey,JSON.stringify(e.instance.progressionStore)),e.SyncStorage.setItem(e.KeyPrefix+e.ItemsStoreKey,JSON.stringify(e.instance.storeItems)))},e.load=function(){if(e.isStorageAvailable()){try{e.instance.eventsStore=JSON.parse(e.SyncStorage.getItem(e.KeyPrefix+e.EventsStoreKey)),e.instance.eventsStore||(e.instance.eventsStore=[])}catch(n){e.instance.eventsStore=[]}try{e.instance.sessionsStore=JSON.parse(e.SyncStorage.getItem(e.KeyPrefix+e.SessionsStoreKey)),e.instance.sessionsStore||(e.instance.sessionsStore=[])}catch(n){e.instance.sessionsStore=[]}try{e.instance.progressionStore=JSON.parse(e.SyncStorage.getItem(e.KeyPrefix+e.ProgressionStoreKey)),e.instance.progressionStore||(e.instance.progressionStore=[])}catch(n){e.instance.progressionStore=[]}try{e.instance.storeItems=JSON.parse(e.SyncStorage.getItem(e.KeyPrefix+e.ItemsStoreKey)),e.instance.storeItems||(e.instance.storeItems={})}catch(n){e.instance.progressionStore=[]}}},e.setItem=function(n,t){var i=e.KeyPrefix+n;t?e.instance.storeItems[i]=t:i in e.instance.storeItems&&delete e.instance.storeItems[i]},e.getItem=function(n){var t=e.KeyPrefix+n;return t in e.instance.storeItems?e.instance.storeItems[t]:null},e.getStore=function(n){switch(n){case i.Events:return e.instance.eventsStore;case i.Sessions:return e.instance.sessionsStore;case i.Progression:return e.instance.progressionStore;default:return null}},e.instance=new e,e.SyncStorage=new n.SyncStorage,e.MaxNumberOfEntries=2e3,e.KeyPrefix="GA::",e.EventsStoreKey="ga_event",e.SessionsStoreKey="ga_session",e.ProgressionStoreKey="ga_progression",e.ItemsStoreKey="ga_items",e}();e.GAStore=s}(n=e.store||(e.store={}))}(gameanalytics||(gameanalytics={}));var gameanalytics;!function(e){!function(n){var t=e.validators.GAValidator,i=e.utilities.GAUtilities,r=e.store.GAStore,s=e.device.GADevice,o=e.store.EGAStore,a=e.store.EGAStoreArgsOperator,u=function(){function n(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.configurations={},this.commandCenterListeners=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={}}return n.setUserId=function(e){n.instance.userId=e,n.cacheIdentifier()},n.getIdentifier=function(){return n.instance.identifier},n.isInitialized=function(){return n.instance.initialized},n.setInitialized=function(e){n.instance.initialized=e},n.getSessionStart=function(){return n.instance.sessionStart},n.getSessionNum=function(){return n.instance.sessionNum},n.getTransactionNum=function(){return n.instance.transactionNum},n.getSessionId=function(){return n.instance.sessionId},n.getCurrentCustomDimension01=function(){return n.instance.currentCustomDimension01},n.getCurrentCustomDimension02=function(){return n.instance.currentCustomDimension02},n.getCurrentCustomDimension03=function(){return n.instance.currentCustomDimension03},n.getGameKey=function(){return n.instance.gameKey},n.getGameSecret=function(){return n.instance.gameSecret},n.getAvailableCustomDimensions01=function(){return n.instance.availableCustomDimensions01},n.setAvailableCustomDimensions01=function(e){t.validateCustomDimensions(e)&&(n.instance.availableCustomDimensions01=e,n.validateAndFixCurrentDimensions())},n.getAvailableCustomDimensions02=function(){return n.instance.availableCustomDimensions02},n.setAvailableCustomDimensions02=function(e){t.validateCustomDimensions(e)&&(n.instance.availableCustomDimensions02=e,n.validateAndFixCurrentDimensions())},n.getAvailableCustomDimensions03=function(){return n.instance.availableCustomDimensions03},n.setAvailableCustomDimensions03=function(e){t.validateCustomDimensions(e)&&(n.instance.availableCustomDimensions03=e,n.validateAndFixCurrentDimensions())},n.getAvailableResourceCurrencies=function(){return n.instance.availableResourceCurrencies},n.setAvailableResourceCurrencies=function(e){t.validateResourceCurrencies(e)&&(n.instance.availableResourceCurrencies=e)},n.getAvailableResourceItemTypes=function(){return n.instance.availableResourceItemTypes},n.setAvailableResourceItemTypes=function(e){t.validateResourceItemTypes(e)&&(n.instance.availableResourceItemTypes=e)},n.getBuild=function(){return n.instance.build},n.setBuild=function(e){n.instance.build=e},n.getUseManualSessionHandling=function(){return n.instance.useManualSessionHandling},n.prototype.setDefaultId=function(e){this.defaultUserId=e||"",n.cacheIdentifier()},n.getDefaultId=function(){return n.instance.defaultUserId},n.getSdkConfig=function(){var e,t=0;for(var i in n.instance.sdkConfig)0===t&&(e=i),++t;if(e&&t>0)return n.instance.sdkConfig;var e,t=0;for(var i in n.instance.sdkConfigCached)0===t&&(e=i),++t;return e&&t>0?n.instance.sdkConfigCached:n.instance.sdkConfigDefault},n.isEnabled=function(){var e=n.getSdkConfig();return(!e.enabled||"false"!=e.enabled)&&!!n.instance.initAuthorized},n.setCustomDimension01=function(e){n.instance.currentCustomDimension01=e,r.setItem(n.Dimension01Key,e)},n.setCustomDimension02=function(e){n.instance.currentCustomDimension02=e,r.setItem(n.Dimension02Key,e)},n.setCustomDimension03=function(e){n.instance.currentCustomDimension03=e,r.setItem(n.Dimension03Key,e)},n.setFacebookId=function(e){n.instance.facebookId=e,r.setItem(n.FacebookIdKey,e)},n.setGender=function(t){n.instance.gender=isNaN(Number(e.EGAGender[t]))?e.EGAGender[t].toString().toLowerCase():e.EGAGender[e.EGAGender[t]].toString().toLowerCase(),r.setItem(n.GenderKey,n.instance.gender)},n.setBirthYear=function(e){n.instance.birthYear=e,r.setItem(n.BirthYearKey,e.toString())},n.incrementSessionNum=function(){var e=n.getSessionNum()+1;n.instance.sessionNum=e},n.incrementTransactionNum=function(){var e=n.getTransactionNum()+1;n.instance.transactionNum=e},n.incrementProgressionTries=function(e){var t=n.getProgressionTries(e)+1;n.instance.progressionTries[e]=t;var i={};i.progression=e,i.tries=t,r.insert(o.Progression,i,!0,"progression")},n.getProgressionTries=function(e){return e in n.instance.progressionTries?n.instance.progressionTries[e]:0},n.clearProgressionTries=function(e){e in n.instance.progressionTries&&delete n.instance.progressionTries[e];var t=[];t.push(["progression",a.Equal,e]),r.delete(o.Progression,t)},n.setKeys=function(e,t){n.instance.gameKey=e,n.instance.gameSecret=t},n.setManualSessionHandling=function(e){n.instance.useManualSessionHandling=e},n.getEventAnnotations=function(){var e={};e.v=2,e.user_id=n.instance.identifier,e.client_ts=n.getClientTsAdjusted(),e.sdk_version=s.getRelevantSdkVersion(),e.os_version=s.osVersion,e.manufacturer=s.deviceManufacturer,e.device=s.deviceModel,e.browser_version=s.browserVersion,e.platform=s.buildPlatform,e.session_id=n.instance.sessionId,e[n.SessionNumKey]=n.instance.sessionNum;var i=s.getConnectionType();return t.validateConnectionType(i)&&(e.connection_type=i),s.gameEngineVersion&&(e.engine_version=s.gameEngineVersion),n.instance.build&&(e.build=n.instance.build),n.instance.facebookId&&(e[n.FacebookIdKey]=n.instance.facebookId),n.instance.gender&&(e[n.GenderKey]=n.instance.gender),0!=n.instance.birthYear&&(e[n.BirthYearKey]=n.instance.birthYear),e},n.getSdkErrorEventAnnotations=function(){var e={};e.v=2,e.category=n.CategorySdkError,e.sdk_version=s.getRelevantSdkVersion(),e.os_version=s.osVersion,e.manufacturer=s.deviceManufacturer,e.device=s.deviceModel,e.platform=s.buildPlatform;var i=s.getConnectionType();return t.validateConnectionType(i)&&(e.connection_type=i),s.gameEngineVersion&&(e.engine_version=s.gameEngineVersion),e},n.getInitAnnotations=function(){var e={};return e.user_id=n.getIdentifier(),e.sdk_version=s.getRelevantSdkVersion(),e.os_version=s.osVersion,e.platform=s.buildPlatform,e},n.getClientTsAdjusted=function(){var e=i.timeIntervalSince1970(),r=e+n.instance.clientServerTimeOffset;return t.validateClientTs(r)?r:e},n.sessionIsStarted=function(){return 0!=n.instance.sessionStart},n.cacheIdentifier=function(){n.instance.userId?n.instance.identifier=n.instance.userId:n.instance.defaultUserId&&(n.instance.identifier=n.instance.defaultUserId)},n.ensurePersistedStates=function(){r.isStorageAvailable()&&r.load();var e=n.instance;e.setDefaultId(null!=r.getItem(n.DefaultUserIdKey)?r.getItem(n.DefaultUserIdKey):i.createGuid()),e.sessionNum=null!=r.getItem(n.SessionNumKey)?Number(r.getItem(n.SessionNumKey)):0,e.transactionNum=null!=r.getItem(n.TransactionNumKey)?Number(r.getItem(n.TransactionNumKey)):0,e.facebookId?r.setItem(n.FacebookIdKey,e.facebookId):(e.facebookId=null!=r.getItem(n.FacebookIdKey)?r.getItem(n.FacebookIdKey):"",e.facebookId),e.gender?r.setItem(n.GenderKey,e.gender):(e.gender=null!=r.getItem(n.GenderKey)?r.getItem(n.GenderKey):"",e.gender),e.birthYear&&0!=e.birthYear?r.setItem(n.BirthYearKey,e.birthYear.toString()):(e.birthYear=null!=r.getItem(n.BirthYearKey)?Number(r.getItem(n.BirthYearKey)):0,e.birthYear),e.currentCustomDimension01?r.setItem(n.Dimension01Key,e.currentCustomDimension01):(e.currentCustomDimension01=null!=r.getItem(n.Dimension01Key)?r.getItem(n.Dimension01Key):"",e.currentCustomDimension01),e.currentCustomDimension02?r.setItem(n.Dimension02Key,e.currentCustomDimension02):(e.currentCustomDimension02=null!=r.getItem(n.Dimension02Key)?r.getItem(n.Dimension02Key):"",e.currentCustomDimension02),e.currentCustomDimension03?r.setItem(n.Dimension03Key,e.currentCustomDimension03):(e.currentCustomDimension03=null!=r.getItem(n.Dimension03Key)?r.getItem(n.Dimension03Key):"",e.currentCustomDimension03);var t=null!=r.getItem(n.SdkConfigCachedKey)?r.getItem(n.SdkConfigCachedKey):"";if(t){var s=JSON.parse(i.decode64(t));s&&(e.sdkConfigCached=s)}var a=r.select(o.Progression);if(a)for(var u=0;u<a.length;++u){var c=a[u];c&&(e.progressionTries[c.progression]=c.tries)}},n.calculateServerTimeOffset=function(e){return e-i.timeIntervalSince1970()},n.validateAndCleanCustomFields=function(e){var t={};if(e){var r=0;for(var s in e){var o=e[s];if(s&&o){if(r<n.MAX_CUSTOM_FIELDS_COUNT){var a=new RegExp("^[a-zA-Z0-9_]{1,"+n.MAX_CUSTOM_FIELDS_KEY_LENGTH+"}$");if(i.stringMatch(s,a)){var u=typeof o;if("string"===u||o instanceof String){var c=o;c.length<=n.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH&&c.length>0&&(t[s]=c,++r)}else if("number"===u||o instanceof Number){var d=o;t[s]=d,++r}}}}else;}}return t},n.validateAndFixCurrentDimensions=function(){t.validateDimension01(n.getCurrentCustomDimension01(),n.getAvailableCustomDimensions01())||n.setCustomDimension01(""),t.validateDimension02(n.getCurrentCustomDimension02(),n.getAvailableCustomDimensions02())||n.setCustomDimension02(""),t.validateDimension03(n.getCurrentCustomDimension03(),n.getAvailableCustomDimensions03())||n.setCustomDimension03("")},n.getConfigurationStringValue=function(e,t){return n.instance.configurations[e]?n.instance.configurations[e].toString():t},n.isCommandCenterReady=function(){return n.instance.commandCenterIsReady},n.addCommandCenterListener=function(e){n.instance.commandCenterListeners.indexOf(e);n.instance.commandCenterListeners.indexOf(e)<0&&n.instance.commandCenterListeners.push(e)},n.removeCommandCenterListener=function(e){var t=n.instance.commandCenterListeners.indexOf(e);t>-1&&n.instance.commandCenterListeners.splice(t,1)},n.getConfigurationsContentAsString=function(){return JSON.stringify(n.instance.configurations)},n.populateConfigurations=function(e){var t=e.configurations;if(t)for(var i=0;i<t.length;++i){var r=t[i];if(r){var s=r.key,o=r.value,a=r.start?r.start:Number.MIN_VALUE,u=r.end?r.end:Number.MAX_VALUE,c=n.getClientTsAdjusted();s&&o&&c>a&&c<u&&(n.instance.configurations[s]=o)}}n.instance.commandCenterIsReady=!0;for(var d=n.instance.commandCenterListeners,i=0;i<d.length;++i)d[i]&&d[i].onCommandCenterUpdated()},n.CategorySdkError="sdk_error",n.MAX_CUSTOM_FIELDS_COUNT=50,n.MAX_CUSTOM_FIELDS_KEY_LENGTH=64,n.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH=256,n.instance=new n,n.DefaultUserIdKey="default_user_id",n.SessionNumKey="session_num",n.TransactionNumKey="transaction_num",n.FacebookIdKey="facebook_id",n.GenderKey="gender",n.BirthYearKey="birth_year",n.Dimension01Key="dimension01",n.Dimension02Key="dimension02",n.Dimension03Key="dimension03",n.SdkConfigCachedKey="sdk_config_cached",n}();n.GAState=u}(e.state||(e.state={}))}(gameanalytics||(gameanalytics={}))
;var gameanalytics;!function(e){!function(n){var t=e.utilities.GAUtilities,i=function(){function e(){}return e.execute=function(n,i,r,s){if(e.countMap[i]||(e.countMap[i]=0),!(e.countMap[i]>=e.MaxCount)){var o=t.getHmac(s,r),a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState){if(!a.responseText)return;if(200!=a.status)return;e.countMap[i]=e.countMap[i]+1}},a.open("POST",n,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization",o);try{a.send(r)}catch(e){console.error(e)}}},e.MaxCount=10,e.countMap={},e}();n.SdkErrorTask=i}(e.tasks||(e.tasks={}))}(gameanalytics||(gameanalytics={}));var gameanalytics;!function(e){!function(n){var t=e.state.GAState,i=e.utilities.GAUtilities,r=e.validators.GAValidator,s=e.tasks.SdkErrorTask,o=function(){function e(){this.protocol="https",this.hostName="api.gameanalytics.com",this.version="v2",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}return e.prototype.requestInit=function(i){var r=t.getGameKey(),s=this.baseUrl+"/"+r+"/"+this.initializeUrlPath;s="https://rubick.gameanalytics.com/v2/command_center?game_key="+r+"&interval_seconds=1000000";var o=t.getInitAnnotations(),a=JSON.stringify(o);if(!a)return void i(n.EGAHTTPApiResponse.JsonEncodeFailed,null);var u=this.createPayloadData(a,this.useGzip),c=[];c.push(a),e.sendRequest(s,u,c,this.useGzip,e.initRequestCallback,i)},e.prototype.sendEventsInArray=function(i,r,s){if(0!=i.length){var o=t.getGameKey(),a=this.baseUrl+"/"+o+"/"+this.eventsUrlPath,u=JSON.stringify(i);if(!u)return void s(n.EGAHTTPApiResponse.JsonEncodeFailed,null,r,i.length);var c=this.createPayloadData(u,this.useGzip),d=[];d.push(u),d.push(r),d.push(i.length.toString()),e.sendRequest(a,c,d,this.useGzip,e.sendEventInArrayRequestCallback,s)}},e.prototype.sendSdkErrorEvent=function(n){var i=t.getGameKey(),o=t.getGameSecret();if(r.validateSdkErrorEvent(i,o,n)){var a=this.baseUrl+"/"+i+"/"+this.eventsUrlPath,u="",c=t.getSdkErrorEventAnnotations(),d=e.sdkErrorTypeToString(n);c.type=d;var l=[];l.push(c),u=JSON.stringify(l),u&&s.execute(a,n,u,o)}},e.sendEventInArrayRequestCallback=function(t,i,r,s){void 0===s&&(s=null);var o=(s[0],s[1],s[2]),a=parseInt(s[3]),u="",c=0;u=t.responseText,c=t.status;var d=e.instance.processRequestResponse(c,t.statusText,u,"Events");if(d!=n.EGAHTTPApiResponse.Ok&&d!=n.EGAHTTPApiResponse.BadRequest)return void r(d,null,o,a);var l=u?JSON.parse(u):{};if(null==l)return void r(n.EGAHTTPApiResponse.JsonDecodeFailed,null,o,a);n.EGAHTTPApiResponse.BadRequest,r(d,l,o,a)},e.sendRequest=function(e,n,r,s,o,a){var u=new XMLHttpRequest,c=t.getGameSecret(),d=i.getHmac(c,n),l=[];l.push(d);for(var f in r)l.push(r[f]);if(u.onreadystatechange=function(){4===u.readyState&&o(u,e,a,l)},u.open("POST",e,!0),u.setRequestHeader("Content-Type","text/plain"),u.setRequestHeader("Authorization",d),s)throw new Error("gzip not supported");try{u.send(n)}catch(e){console.error(e.stack)}},e.initRequestCallback=function(t,i,s,o){void 0===o&&(o=null);var a=(o[0],o[1],""),u=0;a=t.responseText,u=t.status;var c=a?JSON.parse(a):{},d=e.instance.processRequestResponse(u,t.statusText,a,"Init");if(d!=n.EGAHTTPApiResponse.Ok&&d!=n.EGAHTTPApiResponse.BadRequest)return void s(d,null,"",0);if(null==c)return void s(n.EGAHTTPApiResponse.JsonDecodeFailed,null,"",0);if(d===n.EGAHTTPApiResponse.BadRequest)return void s(d,null,"",0);var l=r.validateAndCleanInitRequestResponse(c);if(!l)return void s(n.EGAHTTPApiResponse.BadResponse,null,"",0);s(n.EGAHTTPApiResponse.Ok,l,"",0)},e.prototype.createPayloadData=function(e,n){if(n)throw new Error("gzip not supported");return e},e.prototype.processRequestResponse=function(e,t,i,r){return i?200===e?n.EGAHTTPApiResponse.Ok:0===e||401===e?n.EGAHTTPApiResponse.Unauthorized:400===e?n.EGAHTTPApiResponse.BadRequest:500===e?n.EGAHTTPApiResponse.InternalServerError:n.EGAHTTPApiResponse.UnknownResponseCode:n.EGAHTTPApiResponse.NoResponse},e.sdkErrorTypeToString=function(e){switch(e){case n.EGASdkErrorType.Rejected:return"rejected";default:return""}},e.instance=new e,e}();n.GAHTTPApi=o}(e.http||(e.http={}))}(gameanalytics||(gameanalytics={}));var gameanalytics;!function(e){!function(n){var t=e.store.GAStore,i=e.store.EGAStore,r=e.store.EGAStoreArgsOperator,s=e.state.GAState,o=e.utilities.GAUtilities,a=e.http.EGAHTTPApiResponse,u=e.http.GAHTTPApi,c=e.validators.GAValidator,d=e.http.EGASdkErrorType,l=function(){function n(){}return n.addSessionStartEvent=function(){var e={};e.category=n.CategorySessionStart,s.incrementSessionNum(),t.setItem(s.SessionNumKey,s.getSessionNum().toString()),n.addDimensionsToEvent(e),n.addEventToStore(e),n.processEvents(n.CategorySessionStart,!1)},n.addSessionEndEvent=function(){var e=s.getSessionStart(),t=s.getClientTsAdjusted(),i=t-e;i<0&&(i=0);var r={};r.category=n.CategorySessionEnd,r.length=i,n.addDimensionsToEvent(r),n.addEventToStore(r),n.processEvents("",!1)},n.addBusinessEvent=function(e,i,r,o,a,l){if(void 0===a&&(a=null),!c.validateBusinessEvent(e,i,a,r,o))return void u.instance.sendSdkErrorEvent(d.Rejected);var f={};s.incrementTransactionNum(),t.setItem(s.TransactionNumKey,s.getTransactionNum().toString()),f.event_id=r+":"+o,f.category=n.CategoryBusiness,f.currency=e,f.amount=i,f[s.TransactionNumKey]=s.getTransactionNum(),a&&(f.cart_type=a),n.addDimensionsToEvent(f),n.addFieldsToEvent(f,s.validateAndCleanCustomFields(l)),n.addEventToStore(f)},n.addResourceEvent=function(t,i,r,o,a,l){if(!c.validateResourceEvent(t,i,r,o,a,s.getAvailableResourceCurrencies(),s.getAvailableResourceItemTypes()))return void u.instance.sendSdkErrorEvent(d.Rejected);t===e.EGAResourceFlowType.Sink&&(r*=-1);var f={},v=n.resourceFlowTypeToString(t);f.event_id=v+":"+i+":"+o+":"+a,f.category=n.CategoryResource,f.amount=r,n.addDimensionsToEvent(f),n.addFieldsToEvent(f,s.validateAndCleanCustomFields(l)),n.addEventToStore(f)},n.addProgressionEvent=function(t,i,r,o,a,l,f){var v=n.progressionStatusToString(t);if(!c.validateProgressionEvent(t,i,r,o))return void u.instance.sendSdkErrorEvent(d.Rejected);var m,g={};m=r?o?i+":"+r+":"+o:i+":"+r:i,g.category=n.CategoryProgression,g.event_id=v+":"+m;var h=0;l&&t!=e.EGAProgressionStatus.Start&&(g.score=a),t===e.EGAProgressionStatus.Fail&&s.incrementProgressionTries(m),t===e.EGAProgressionStatus.Complete&&(s.incrementProgressionTries(m),h=s.getProgressionTries(m),g.attempt_num=h,s.clearProgressionTries(m)),n.addDimensionsToEvent(g),n.addFieldsToEvent(g,s.validateAndCleanCustomFields(f)),n.addEventToStore(g)},n.addDesignEvent=function(e,t,i,r){if(!c.validateDesignEvent(e,t))return void u.instance.sendSdkErrorEvent(d.Rejected);var o={};o.category=n.CategoryDesign,o.event_id=e,i&&(o.value=t),n.addDimensionsToEvent(o),n.addFieldsToEvent(o,s.validateAndCleanCustomFields(r)),n.addEventToStore(o)},n.addErrorEvent=function(e,t,i){var r=n.errorSeverityToString(e);if(!c.validateErrorEvent(e,t))return void u.instance.sendSdkErrorEvent(d.Rejected);var o={};o.category=n.CategoryError,o.severity=r,o.message=t,n.addDimensionsToEvent(o),n.addFieldsToEvent(o,s.validateAndCleanCustomFields(i)),n.addEventToStore(o)},n.processEvents=function(e,s){try{var a=o.createGuid();s&&(n.cleanupEvents(),n.fixMissingSessionEndEvents());var c=[];c.push(["status",r.Equal,"new"]);var d=[];d.push(["status",r.Equal,"new"]),e&&(c.push(["category",r.Equal,e]),d.push(["category",r.Equal,e]));var l=[];l.push(["status",a]);var f=t.select(i.Events,c);if(!f||0==f.length)return void n.updateSessionStore();if(f.length>n.MaxEventCount){if(!(f=t.select(i.Events,c,!0,n.MaxEventCount)))return;var v=f[f.length-1],m=v.client_ts;if(c.push(["client_ts",r.LessOrEqual,m]),!(f=t.select(i.Events,c)))return;d.push(["client_ts",r.LessOrEqual,m])}if(!t.update(i.Events,l,d))return;for(var g=[],h=0;h<f.length;++h){var p=f[h],y=JSON.parse(o.decode64(p.event));0!=y.length&&g.push(y)}u.instance.sendEventsInArray(g,a,n.processEventsCallback)}catch(e){}},n.processEventsCallback=function(e,n,s,o){var u=[];if(u.push(["status",r.Equal,s]),e===a.Ok)t.delete(i.Events,u);else if(e===a.NoResponse){var c=[];c.push(["status","new"]),t.update(i.Events,c,u)}else{if(n){var d,l=0;for(var f in n)0==l&&(d=n[f]),++l;e===a.BadRequest&&(d.constructor,Array)}t.delete(i.Events,u)}},n.cleanupEvents=function(){t.update(i.Events,[["status","new"]])},n.fixMissingSessionEndEvents=function(){var e=[];e.push(["session_id",r.NotEqual,s.getSessionId()]);var a=t.select(i.Sessions,e);if(a&&0!=a.length)for(var u=0;u<a.length;++u){var c=JSON.parse(o.decode64(a[u].event)),d=c.client_ts,l=a[u].timestamp,f=d-l;f=Math.max(0,f),c.category=n.CategorySessionEnd,c.length=f,n.addEventToStore(c)}},n.addEventToStore=function(e){if(s.isInitialized())try{if(t.isStoreTooLargeForEvents()&&!o.stringMatch(e.category,/^(user|session_end|business)$/))return;var a=s.getEventAnnotations(),u=o.encode64(JSON.stringify(a));for(var c in e)a[c]=e[c];var d=(JSON.stringify(a),{});d.status="new",d.category=a.category,d.session_id=a.session_id,d.client_ts=a.client_ts,d.event=o.encode64(JSON.stringify(a)),t.insert(i.Events,d),e.category==n.CategorySessionEnd?t.delete(i.Sessions,[["session_id",r.Equal,a.session_id]]):(d={},d.session_id=a.session_id,d.timestamp=s.getSessionStart(),d.event=u,t.insert(i.Sessions,d,!0,"session_id")),t.isStorageAvailable()&&t.save()}catch(c){}},n.updateSessionStore=function(){if(s.sessionIsStarted()){var e={};e.session_id=s.instance.sessionId,e.timestamp=s.getSessionStart(),e.event=o.encode64(JSON.stringify(s.getEventAnnotations())),t.insert(i.Sessions,e,!0,"session_id"),t.isStorageAvailable()&&t.save()}},n.addDimensionsToEvent=function(e){e&&(s.getCurrentCustomDimension01()&&(e.custom_01=s.getCurrentCustomDimension01()),s.getCurrentCustomDimension02()&&(e.custom_02=s.getCurrentCustomDimension02()),s.getCurrentCustomDimension03()&&(e.custom_03=s.getCurrentCustomDimension03()))},n.addFieldsToEvent=function(e,n){e&&n&&Object.keys(n).length>0&&(e.custom_fields=n)},n.resourceFlowTypeToString=function(n){return n==e.EGAResourceFlowType.Source||n==e.EGAResourceFlowType[e.EGAResourceFlowType.Source]?"Source":n==e.EGAResourceFlowType.Sink||n==e.EGAResourceFlowType[e.EGAResourceFlowType.Sink]?"Sink":""},n.progressionStatusToString=function(n){return n==e.EGAProgressionStatus.Start||n==e.EGAProgressionStatus[e.EGAProgressionStatus.Start]?"Start":n==e.EGAProgressionStatus.Complete||n==e.EGAProgressionStatus[e.EGAProgressionStatus.Complete]?"Complete":n==e.EGAProgressionStatus.Fail||n==e.EGAProgressionStatus[e.EGAProgressionStatus.Fail]?"Fail":""},n.errorSeverityToString=function(n){return n==e.EGAErrorSeverity.Debug||n==e.EGAErrorSeverity[e.EGAErrorSeverity.Debug]?"debug":n==e.EGAErrorSeverity.Info||n==e.EGAErrorSeverity[e.EGAErrorSeverity.Info]?"info":n==e.EGAErrorSeverity.Warning||n==e.EGAErrorSeverity[e.EGAErrorSeverity.Warning]?"warning":n==e.EGAErrorSeverity.Error||n==e.EGAErrorSeverity[e.EGAErrorSeverity.Error]?"error":n==e.EGAErrorSeverity.Critical||n==e.EGAErrorSeverity[e.EGAErrorSeverity.Critical]?"critical":""},n.instance=new n,n.CategorySessionStart="user",n.CategorySessionEnd="session_end",n.CategoryDesign="design",n.CategoryBusiness="business",n.CategoryProgression="progression",n.CategoryResource="resource",n.CategoryError="error",n.MaxEventCount=500,n}();n.GAEvents=l}(e.events||(e.events={}))}(gameanalytics||(gameanalytics={}));var gameanalytics;!function(e){!function(n){var t=e.state.GAState,i=e.events.GAEvents,r=function(){function e(){this.blocks=new n.PriorityQueue({compare:function(e,n){return e-n}}),this.id2TimedBlockMap={},e.startThread()}return e.createTimedBlock=function(e){void 0===e&&(e=0);var t=new Date;return t.setSeconds(t.getSeconds()+e),new n.TimedBlock(t)},e.performTaskOnGAThread=function(t,i){void 0===i&&(i=0);var r=new Date;r.setSeconds(r.getSeconds()+i);var s=new n.TimedBlock(r);s.block=t,e.instance.id2TimedBlockMap[s.id]=s,e.instance.addTimedBlock(s)},e.performTimedBlockOnGAThread=function(n){e.instance.id2TimedBlockMap[n.id]=n,e.instance.addTimedBlock(n)},e.scheduleTimer=function(t,i){var r=new Date;r.setSeconds(r.getSeconds()+t);var s=new n.TimedBlock(r);return s.block=i,e.instance.id2TimedBlockMap[s.id]=s,e.instance.addTimedBlock(s),s.id},e.getTimedBlockById=function(n){return n in e.instance.id2TimedBlockMap?e.instance.id2TimedBlockMap[n]:null},e.ensureEventQueueIsRunning=function(){e.instance.keepRunning=!0,e.instance.isRunning||(e.instance.isRunning=!0,e.scheduleTimer(e.ProcessEventsIntervalInSeconds,e.processEventQueue))},e.endSessionAndStopQueue=function(){t.isInitialized()&&(e.stopEventQueue(),t.isEnabled()&&t.sessionIsStarted()&&(i.addSessionEndEvent(),t.instance.sessionStart=0))},e.stopEventQueue=function(){e.instance.keepRunning=!1},e.ignoreTimer=function(n){n in e.instance.id2TimedBlockMap&&(e.instance.id2TimedBlockMap[n].ignore=!0)},e.setEventProcessInterval=function(n){n>0&&(e.ProcessEventsIntervalInSeconds=n)},e.prototype.addTimedBlock=function(e){this.blocks.enqueue(e.deadline.getTime(),e)},e.run=function(){clearTimeout(e.runTimeoutId);try{for(var n;n=e.getNextBlock();)if(!n.ignore)if(n.async){if(!n.running){n.running=!0,n.block();break}}else n.block();return void(e.runTimeoutId=setTimeout(e.run,e.ThreadWaitTimeInMs))}catch(e){}},e.startThread=function(){e.runTimeoutId=setTimeout(e.run,0)},e.getNextBlock=function(){var n=new Date;return e.instance.blocks.hasItems()&&e.instance.blocks.peek().deadline.getTime()<=n.getTime()?e.instance.blocks.peek().async&&e.instance.blocks.peek().running?e.instance.blocks.peek():e.instance.blocks.dequeue():null},e.processEventQueue=function(){i.processEvents("",!0),e.instance.keepRunning?e.scheduleTimer(e.ProcessEventsIntervalInSeconds,e.processEventQueue):e.instance.isRunning=!1},e.instance=new e,e.ThreadWaitTimeInMs=1e3,e.ProcessEventsIntervalInSeconds=8,e}();n.GAThreading=r}(e.threading||(e.threading={}))}(gameanalytics||(gameanalytics={}));var gameanalytics;!function(e){var n=e.threading.GAThreading,t=e.store.GAStore,i=e.state.GAState,r=e.http.GAHTTPApi,s=e.device.GADevice,o=e.validators.GAValidator,a=e.http.EGAHTTPApiResponse,u=e.utilities.GAUtilities,c=e.events.GAEvents,d=function(){function d(){}return d.init=function(){if(s.touch(),d.methodMap.configureAvailableCustomDimensions01=d.configureAvailableCustomDimensions01,d.methodMap.configureAvailableCustomDimensions02=d.configureAvailableCustomDimensions02,d.methodMap.configureAvailableCustomDimensions03=d.configureAvailableCustomDimensions03,d.methodMap.configureAvailableResourceCurrencies=d.configureAvailableResourceCurrencies,d.methodMap.configureAvailableResourceItemTypes=d.configureAvailableResourceItemTypes,d.methodMap.configureBuild=d.configureBuild,d.methodMap.configureSdkGameEngineVersion=d.configureSdkGameEngineVersion,d.methodMap.configureGameEngineVersion=d.configureGameEngineVersion,d.methodMap.configureUserId=d.configureUserId,d.methodMap.initialize=d.initialize,d.methodMap.addBusinessEvent=d.addBusinessEvent,d.methodMap.addResourceEvent=d.addResourceEvent,d.methodMap.addProgressionEvent=d.addProgressionEvent,d.methodMap.addDesignEvent=d.addDesignEvent,d.methodMap.addErrorEvent=d.addErrorEvent,d.methodMap.addErrorEvent=d.addErrorEvent,d.methodMap.setEnabledInfoLog=d.setEnabledInfoLog,d.methodMap.setEnabledVerboseLog=d.setEnabledVerboseLog,d.methodMap.setEnabledManualSessionHandling=d.setEnabledManualSessionHandling,d.methodMap.setCustomDimension01=d.setCustomDimension01,d.methodMap.setCustomDimension02=d.setCustomDimension02,d.methodMap.setCustomDimension03=d.setCustomDimension03,d.methodMap.setFacebookId=d.setFacebookId,d.methodMap.setGender=d.setGender,d.methodMap.setBirthYear=d.setBirthYear,d.methodMap.setEventProcessInterval=d.setEventProcessInterval,d.methodMap.startSession=d.startSession,d.methodMap.endSession=d.endSession,d.methodMap.onStop=d.onStop,d.methodMap.onResume=d.onResume,d.methodMap.addCommandCenterListener=d.addCommandCenterListener,d.methodMap.removeCommandCenterListener=d.removeCommandCenterListener,d.methodMap.getCommandCenterValueAsString=d.getCommandCenterValueAsString,d.methodMap.isCommandCenterReady=d.isCommandCenterReady,d.methodMap.getConfigurationsContentAsString=d.getConfigurationsContentAsString,"undefined"!=typeof window&&void 0!==window.GameAnalytics&&void 0!==window.GameAnalytics.q){var e=window.GameAnalytics.q;for(var n in e)d.gaCommand.apply(null,e[n])}},d.gaCommand=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];n.length>0&&n[0]in e.GameAnalytics.methodMap&&(n.length>1?e.GameAnalytics.methodMap[n[0]].apply(null,Array.prototype.slice.call(n,1)):e.GameAnalytics.methodMap[n[0]]())},d.configureAvailableCustomDimensions01=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!1)||i.setAvailableCustomDimensions01(e)})},d.configureAvailableCustomDimensions02=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!1)||i.setAvailableCustomDimensions02(e)})},d.configureAvailableCustomDimensions03=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!1)||i.setAvailableCustomDimensions03(e)})},d.configureAvailableResourceCurrencies=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!1)||i.setAvailableResourceCurrencies(e)})},d.configureAvailableResourceItemTypes=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!1)||i.setAvailableResourceItemTypes(e)})},d.configureBuild=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!1)||o.validateBuild(e)&&i.setBuild(e)})},d.configureSdkGameEngineVersion=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!1)||o.validateSdkWrapperVersion(e)&&(s.sdkGameEngineVersion=e)})},d.configureGameEngineVersion=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!1)||o.validateEngineVersion(e)&&(s.gameEngineVersion=e)})},d.configureUserId=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!1)||o.validateUserId(e)&&i.setUserId(e)})},d.initialize=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),s.updateConnectionType();var r=n.createTimedBlock();r.async=!0,d.initTimedBlockId=r.id,r.block=function(){d.isSdkReady(!0,!1)||o.validateKeys(e,t)&&(i.setKeys(e,t),d.internalInitialize())},n.performTimedBlockOnGAThread(r)},d.addBusinessEvent=function(e,t,i,r,o){void 0===e&&(e=""),void 0===t&&(t=0),void 0===i&&(i=""),void 0===r&&(r=""),void 0===o&&(o=""),s.updateConnectionType(),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!0,"Could not add business event")&&c.addBusinessEvent(e,t,i,r,o,{})})},d.addResourceEvent=function(t,i,r,o,a){void 0===t&&(t=e.EGAResourceFlowType.Undefined),void 0===i&&(i=""),void 0===r&&(r=0),void 0===o&&(o=""),void 0===a&&(a=""),s.updateConnectionType(),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!0,"Could not add resource event")&&c.addResourceEvent(t,i,r,o,a,{})})},d.addProgressionEvent=function(t,i,r,o,a){void 0===t&&(t=e.EGAProgressionStatus.Undefined),void 0===i&&(i=""),void 0===r&&(r=""),void 0===o&&(o=""),s.updateConnectionType(),n.performTaskOnGAThread(function(){if(d.isSdkReady(!0,!0,"Could not add progression event")){var e="number"==typeof a;c.addProgressionEvent(t,i,r,o,e?a:0,e,{})}})},d.addDesignEvent=function(e,t){s.updateConnectionType(),n.performTaskOnGAThread(function(){if(d.isSdkReady(!0,!0,"Could not add design event")){var n="number"==typeof t;c.addDesignEvent(e,n?t:0,n,{})}})},d.addErrorEvent=function(t,i){void 0===t&&(t=e.EGAErrorSeverity.Undefined),void 0===i&&(i=""),s.updateConnectionType(),n.performTaskOnGAThread(function(){d.isSdkReady(!0,!0,"Could not add error event")&&c.addErrorEvent(t,i,{})})},d.setEnabledInfoLog=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){})},d.setEnabledVerboseLog=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){})},d.setEnabledManualSessionHandling=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){i.setManualSessionHandling(e)})},d.setCustomDimension01=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){o.validateDimension01(e,i.getAvailableCustomDimensions01())&&i.setCustomDimension01(e)})},d.setCustomDimension02=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){o.validateDimension02(e,i.getAvailableCustomDimensions02())&&i.setCustomDimension02(e)})},d.setCustomDimension03=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){o.validateDimension03(e,i.getAvailableCustomDimensions03())&&i.setCustomDimension03(e)})},d.setFacebookId=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){o.validateFacebookId(e)&&i.setFacebookId(e)})},d.setGender=function(t){void 0===t&&(t=e.EGAGender.Undefined),n.performTaskOnGAThread(function(){o.validateGender(t)&&i.setGender(t)})},d.setBirthYear=function(e){void 0===e&&(e=0),n.performTaskOnGAThread(function(){o.validateBirthyear(e)&&i.setBirthYear(e)})},d.setEventProcessInterval=function(e){n.performTaskOnGAThread(function(){n.setEventProcessInterval(e)})},d.startSession=function(){if(i.isInitialized()){var e=n.createTimedBlock();e.async=!0,d.initTimedBlockId=e.id,e.block=function(){i.isEnabled()&&i.sessionIsStarted()&&n.endSessionAndStopQueue(),d.resumeSessionAndStartQueue()},n.performTimedBlockOnGAThread(e)}},d.endSession=function(){d.onStop()},d.onStop=function(){n.performTaskOnGAThread(function(){try{n.endSessionAndStopQueue()}catch(e){}})},d.onResume=function(){var e=n.createTimedBlock();e.async=!0,d.initTimedBlockId=e.id,e.block=function(){d.resumeSessionAndStartQueue()},n.performTimedBlockOnGAThread(e)},d.getCommandCenterValueAsString=function(e,n){return void 0===n&&(n=null),i.getConfigurationStringValue(e,n)},d.isCommandCenterReady=function(){return i.isCommandCenterReady()},d.addCommandCenterListener=function(e){i.addCommandCenterListener(e)},d.removeCommandCenterListener=function(e){i.removeCommandCenterListener(e)},d.getConfigurationsContentAsString=function(){return i.getConfigurationsContentAsString()},d.internalInitialize=function(){i.ensurePersistedStates(),t.setItem(i.DefaultUserIdKey,i.getDefaultId()),i.setInitialized(!0),d.newSession(),i.isEnabled()&&n.ensureEventQueueIsRunning()},d.newSession=function(){i.validateAndFixCurrentDimensions(),r.instance.requestInit(d.startNewSessionCallback)},d.startNewSessionCallback=function(e,r){if(e===a.Ok&&r){var s=0;if(r.server_ts){var o=r.server_ts;s=i.calculateServerTimeOffset(o)}r.time_offset=s,t.setItem(i.SdkConfigCachedKey,u.encode64(JSON.stringify(r))),i.instance.sdkConfigCached=r,i.instance.sdkConfig=r,i.instance.initAuthorized=!0}else e==a.Unauthorized?i.instance.initAuthorized=!1:(e===a.NoResponse||e===a.RequestTimeout||e===a.BadResponse||e===a.JsonEncodeFailed||e===a.JsonDecodeFailed||e===a.BadRequest||a.UnknownResponseCode,null==i.instance.sdkConfig&&(null!=i.instance.sdkConfigCached?i.instance.sdkConfig=i.instance.sdkConfigCached:i.instance.sdkConfig=i.instance.sdkConfigDefault),i.instance.initAuthorized=!0);if(i.instance.clientServerTimeOffset=i.getSdkConfig().time_offset?i.getSdkConfig().time_offset:0,i.populateConfigurations(i.getSdkConfig()),!i.isEnabled())return void n.stopEventQueue();n.ensureEventQueueIsRunning();var l=u.createGuid();i.instance.sessionId=l,i.instance.sessionStart=i.getClientTsAdjusted(),c.addSessionStartEvent();var f=n.getTimedBlockById(d.initTimedBlockId);null!=f&&(f.running=!1),d.initTimedBlockId=-1},d.resumeSessionAndStartQueue=function(){i.isInitialized()&&(i.sessionIsStarted()||d.newSession())},d.isSdkReady=function(e,n,t){return void 0===n&&(n=!0),void 0===t&&(t=""),t&&(t+=": "),!(e&&!i.isInitialized())&&(!(e&&!i.isEnabled())&&!(e&&!i.sessionIsStarted()))},d.initTimedBlockId=-1,d.methodMap={},d}();e.GameAnalytics=d}(gameanalytics||(gameanalytics={})),gameanalytics.GameAnalytics.init();var GameAnalytics=gameanalytics.GameAnalytics.gaCommand;
scope.gameanalytics=gameanalytics;
scope.GameAnalytics=GameAnalytics;
})(this);
